; =============================================================================
; CONFIGURACIÓN DE PHP OPCACHE PARA PRODUCCIÓN
; =============================================================================
; 
; Añade estas líneas a tu php.ini en el servidor de producción.
; OPcache es CRÍTICO para reducir el TTFB de 3s a menos de 500ms.
;
; Para verificar si OPcache está habilitado:
;   php -i | grep opcache
;
; Para ver la ubicación de php.ini:
;   php --ini
;
; En cPanel: WHM > MultiPHP INI Editor
; En Plesk: PHP Settings > Additional configuration directives
; =============================================================================

[opcache]
; Habilitar OPcache
opcache.enable=1
opcache.enable_cli=0

; Memoria para scripts compilados (256MB para proyectos grandes)
opcache.memory_consumption=256

; Memoria para strings internados
opcache.interned_strings_buffer=16

; Número máximo de archivos en caché (10000 para Laravel)
opcache.max_accelerated_files=10000

; No validar timestamps en producción (MÁXIMO RENDIMIENTO)
; IMPORTANTE: Después de cada deploy, reiniciar PHP-FPM o Apache
opcache.validate_timestamps=0

; Si prefieres validar cada 60 segundos (menos rendimiento, más conveniente):
; opcache.validate_timestamps=1
; opcache.revalidate_freq=60

; Guardar comentarios (necesario para algunas libraries)
opcache.save_comments=1

; Optimización rápida de código
opcache.fast_shutdown=1

; Precargar Framework de Laravel (PHP 7.4+)
; Descomentar y ajustar la ruta si tu servidor soporta preloading
; opcache.preload=/var/www/html/tu-proyecto/bootstrap/cache/packages.php
; opcache.preload_user=www-data

; =============================================================================
; CONFIGURACIÓN ADICIONAL DE PHP PARA RENDIMIENTO
; =============================================================================

; Aumentar memoria si es necesario
; memory_limit=256M

; Tiempo máximo de ejecución
max_execution_time=60

; Zona horaria
date.timezone=America/Lima

; Logs solo de errores en producción
error_reporting=E_ALL & ~E_DEPRECATED & ~E_STRICT
display_errors=Off
log_errors=On

; Desactivar expose_php por seguridad
expose_php=Off

; =============================================================================
; DESPUÉS DE MODIFICAR php.ini
; =============================================================================
;
; 1. Reiniciar el servicio web:
;    - Apache: sudo systemctl restart apache2
;    - Nginx + PHP-FPM: sudo systemctl restart php8.2-fpm
;    - cPanel: WHM > Restart Services > PHP-FPM
;
; 2. Verificar que OPcache está activo:
;    php -r "var_dump(opcache_get_status());"
;
; 3. En Laravel, crear un endpoint de diagnóstico (opcional):
;    Route::get('/opcache-status', function() {
;        return response()->json(opcache_get_status());
;    })->middleware('auth:admin');
;
; =============================================================================
